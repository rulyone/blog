<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">Post</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/comments.css}" />
    <link rel="stylesheet" th:href="@{/css/animations.css}" />
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
</head>
<body>
    <header class="sticky-header shadow-inset-center">
        <h1><a href="/" style="text-decoration: none;">📝 Quantum Entangled</a></h1>
    </header>

    <div class="container">
        <article class="shadow-inset-center">
            <h2 th:text="${post.title}">Title</h2>
            <div class="date local-date" th:attr="data-time=${post.createdAt}"></div>
            <div class="content" th:utext="${htmlContent}">Post content</div>
        </article>

        <section class="comments">
            <h3>Comments</h3>
          
            <div th:replace="fragments/comments :: commentList" th:with="comments=${post.comments}"></div>
          
            <div sec:authorize="isAuthenticated()" >
              <form th:action="@{'/posts/' + ${post.id} + '/' + ${post.slug} + '/comments'}"
                    th:attr="hx-post=@{'/posts/' + ${post.id} + '/' + ${post.slug} + '/comments'}"
                    hx-target="#comments-list"
                    hx-swap="outerHTML"
                    class="comment-form">
                <textarea name="content" placeholder="Add a comment..." required></textarea>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">Submit Comment</button>
              </form>
            </div>
          
            <div sec:authorize="!isAuthenticated()">
              <p><a href="/oauth2/authorization/github">Login with GitHub</a> to comment.</p>
            </div>
          </section>
          
    </div>

    <script th:src="@{/js/scripts.js}"></script>
</body>
</html>
